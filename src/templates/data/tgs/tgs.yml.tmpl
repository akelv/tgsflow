version: 0.1
project: {{.ProjectName}}

# --- 1) TGS "AI brain" (intelligence for TGS commands only) ---
# Thin default: shelling out to a single provider endpoint (usually OpenAI-compatible).
# You can later switch ai.mode to `proxy` or `mcp` without touching command code.
ai:
  mode: shell                 # shell | proxy | mcp | sdk  (default = shell)
  provider: {{.Provider}}            # hint for shell script; not used by mcp
  model: {{.Model}}
  endpoint: ""                # optional; leave blank for provider default (e.g., OpenAI). Set to custom OpenAI-compatible URL if needed.
  api_key_env: {{.APIKeyEnv}} # TGS reads API key from env; keep secrets out of YAML
  timeout_ms: {{.TimeoutMS}}
  retry:
    max_attempts: {{.MaxAttempts}}
    backoff_ms: {{.BackoffMS}}

  # Toolpack governs which TGS commands are allowed to call the AI "brain".
  # These are one-shot, concise tasks (e.g., context packing, tracing).
  toolpack:
    enabled: true
    allow_for: [context_pack, need_trace, plan_summarize, classify_issue]
    budgets:
      context_pack_tokens: {{.ContextPackTokens}}
      summary_tokens: {{.SummaryTokens}}
    # Optional model routing (same provider family) per task:
    routes:
      context_pack_model: {{.ContextPackModel}}
      summarize_model: {{.SummarizeModel}}
    # Tools that TGS *could* expose to the model when needed (shell mode may ignore).
    tools:
      - name: fetch_repo_text
        desc: "Read small text slices by path+line range for ranking/quotes."
      - name: list_candidates
        desc: "Return candidate doc sections with path, anchor, and score."
      - name: propose_brief
        desc: "Return ordered brief sections within a token budget."
    redaction:
      redact_env_keys: [API_KEY, TOKEN, PASSWORD]
      redact_patterns: ["(?i)secret\\s*[:=]\\s*['\\\"][^'\\\"]+['\\\"]"]

# --- 2) Triggers and guardrails (policy; used by guardrails check & agent runs) ---
triggers:
  issue_labels: {{.IssueLabels}}
  pr_labels: {{.PRLabels}}

guardrails:
  allow_paths: {{.AllowPaths}}
  deny_paths:  {{.DenyPaths}}
  max_diff_lines: 800
  required_checks: {{.RequiredChecks}}
  pr_template: {{.PRTemplate}}
  commit_convention: {{.CommitConvention}}
  ears:
    enable: {{.EARS.Enable}}
    require_shall: {{.EARS.RequireShall}}

# --- 3) Code agents (background editors/reviewers). Many can be registered. ---
# Keep these provider-agnostic. Headless editors read MODEL/API from env as needed.
agents:
  - name: {{.AgentName}}
    type: {{.AgentType}}                 # cli_editor | hosted_reviewer | api_orchestrated
    enabled: {{.AgentEnabled}}
    capabilities: {{.AgentCapabilities}}
    selector:
      labels_any: {{.AgentLabelsAny}}
      paths_any:  {{.AgentPathsAny}}
    runtime:
      bin: {{.AgentBin}}
      args: {{.AgentArgs}}

  # Example placeholder for a future reviewer agent (disabled by default).
  - name: hosted-github-review
    type: hosted_reviewer
    enabled: false
    capabilities: [review_pr, suggest_diffs]
    selector:
      labels_any: ["agent:review", "agent:docs"]
    runtime:
      provider: github_app
      events:
        on_pr: true
        on_comment_commands: ["/tgs-brief", "/tgs-context"]

  # Example placeholder for a future orchestrated agent (disabled by default).
  - name: openhands-staging
    type: api_orchestrated
    enabled: false
    capabilities: [plan, propose_patches]
    selector:
      labels_any: ["agent:openhands"]
    runtime:
      endpoint: "http://openhands.local:4000"
      auth_env: "OPENHANDS_TOKEN"

# --- 4) Steps & prompts (TGS-owned; fed to both brain and agents as needed) ---
steps:
  plan_prompt: tgs/agentops/prompts/plan.md
  impl_prompt: tgs/agentops/prompts/impl.md
  review_prompt: tgs/agentops/prompts/review.md

# --- 5) Telemetry & audit ---
telemetry:
  log_dir: tgs/.tgs/logs
  redact_rules: ["api_key", "token", "password"]

# --- 6) Context packing inputs (where the brain can look) ---
context:
  pack_dir: tgs/design/            # long-lived specs/context/needs
  thoughts_dir: tgs/thoughts/      # per-thought research/plan/impl
  include_globs:
    - README.md
    - docs/**/*.md
    - tgs/**/*.md
